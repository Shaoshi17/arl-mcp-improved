# ARL MCP 工具完整清单

本文档列出了所有可用的 MCP 工具及其详细说明。

## 1. 辅助工具 (3个)

### 1.1 extract_main_domain
从原始 HTTP 请求包中提取主域名。

**参数：**
- `RequestBody` (str): 包含 Host 字段的原始 HTTP 请求包

**返回：**
- 主域名，例如 'baidu.com'、'dzhsj.cn'

**使用场景：**
- 从抓包数据中快速提取目标域名
- 批量处理 HTTP 请求日志

---

### 1.2 extract_domain_or_ip
根据输入文本判断并返回主域名、IP 地址或 IP 段。

**参数：**
- `text` (str): 用户输入，如 www.baidu.com、1.1.1.1、192.168.0.0/24

**返回：**
- 提取出的主域名或 IP 内容

**使用场景：**
- 智能识别用户输入的目标类型
- 标准化目标格式

---

### 1.3 detect_reply_language
根据用户输入自动检测语言，设置全局回复语言。

**参数：**
- `user_prompt` (str): 用户输入的原始提示

**返回：**
- 确认设置的语言提示信息

**使用场景：**
- 自动适配中英文用户
- 国际化支持

---

## 2. 任务管理 (7个)

### 2.1 add_scan_task_and_prompt
向 ARL 平台提交扫描任务。

**参数：**
- `name` (str): 任务名称
- `target` (str): 扫描目标（域名、IP或IP段）
- `domain_brute` (bool): 是否开启域名爆破，默认 True
- `alt_dns` (bool): 是否开启 DNS 字典智能生成，默认 True
- `dns_query_plugin` (bool): 是否开启域名插件查询，默认 True
- `arl_search` (bool): 是否开启 ARL 历史查询，默认 True
- `port_scan` (bool): 是否开启端口扫描，默认 True
- `skip_scan_cdn_ip` (bool): 是否跳过 CDN IP 扫描，默认 True
- `site_identify` (bool): 是否开启站点识别，默认 True
- `search_engines` (bool): 是否开启搜索引擎调用，默认 True
- `site_spider` (bool): 是否开启站点爬虫，默认 True
- `file_leak` (bool): 是否开启文件泄露检测，默认 True
- `findvhost` (bool): 是否开启 Host 碰撞检测，默认 True

**返回：**
- 任务创建结果和预计完成时间

**使用场景：**
- 创建新的资产侦查任务
- 自动化扫描流程

---

### 2.2 list_all_tasks
列出所有任务，支持分页和状态过滤。

**参数：**
- `page` (int): 页码，默认 1
- `size` (int): 每页数量，默认 10
- `status` (str): 任务状态过滤，可选值：waiting, running, done, stop, error

**返回：**
- 任务列表，包含任务名称、目标、状态、开始时间、结束时间等信息

**使用场景：**
- 查看所有扫描任务
- 监控任务执行状态
- 筛选特定状态的任务

---

### 2.3 query_task_status
查询指定任务的执行状态。

**参数：**
- `name` (str): 任务名称

**返回：**
- 各模块完成状态（子域名爆破、IP收集、站点探测、文件泄露检测）

**使用场景：**
- 检查任务进度
- 判断是否可以提取结果

---

### 2.4 query_and_extract
提取任务的完整扫描结果。

**参数：**
- `name` (str): 任务名称
- `domain` (str): 主域名

**返回：**
- 完整的扫描数据（子域名、IP、站点、文件泄露）

**使用场景：**
- 获取任务的所有发现
- 生成扫描报告

---

### 2.5 delete_task
删除一个或多个任务。

**参数：**
- `task_id` (str): 任务ID（可以是单个ID或逗号分隔的多个ID）

**返回：**
- 删除结果

**使用场景：**
- 清理已完成的任务
- 批量删除测试任务

---

### 2.6 stop_task
停止正在运行的任务。

**参数：**
- `task_id` (str): 任务ID

**返回：**
- 停止结果

**使用场景：**
- 中止错误的扫描
- 紧急停止任务

---

### 2.7 export_task_data
导出任务的完整数据。

**参数：**
- `task_id` (str): 任务ID

**返回：**
- 任务的完整数据导出

**使用场景：**
- 备份扫描结果
- 数据分析和处理

---

## 3. 资产查询 (7个)

### 3.1 get_all_subdomains
获取指定域名的所有子域名。

**参数：**
- `domain` (str): 主域名

**返回：**
- 子域名列表

**使用场景：**
- 子域名枚举
- 资产盘点

---

### 3.2 query_ip_list
获取指定域名关联的所有 IP 地址。

**参数：**
- `domain` (str): 主域名

**返回：**
- IP 地址列表

**使用场景：**
- IP 资产收集
- 网络拓扑分析

---

### 3.3 query_site_list
获取指定域名的所有站点。

**参数：**
- `domain` (str): 主域名

**返回：**
- 站点 URL 列表

**使用场景：**
- Web 资产发现
- 站点清单

---

### 3.4 query_fileleak_list
获取指定域名的文件泄露列表。

**参数：**
- `domain` (str): 主域名

**返回：**
- 泄露文件 URL 列表

**使用场景：**
- 敏感信息泄露检测
- 安全风险评估

---

### 3.5 search_asset_domain
搜索资产域名，支持高级过滤。

**参数：**
- `domain` (str): 域名关键词，默认 ""
- `scope_id` (str): 资产范围ID，默认 ""
- `page` (int): 页码，默认 1
- `size` (int): 每页数量，默认 100

**返回：**
- 域名列表及详细信息（类型、解析值、IP列表、来源）

**使用场景：**
- 精确搜索特定域名
- 按资产范围筛选
- 查看域名解析详情

---

### 3.6 search_asset_ip
搜索资产 IP，支持端口信息查询。

**参数：**
- `ip` (str): IP地址关键词，默认 ""
- `domain` (str): 关联域名，默认 ""
- `scope_id` (str): 资产范围ID，默认 ""
- `page` (int): 页码，默认 1
- `size` (int): 每页数量，默认 100

**返回：**
- IP列表及端口信息（开放端口、服务、地理位置、CDN）

**使用场景：**
- IP 资产详细信息查询
- 端口服务识别
- CDN 识别

---

### 3.7 search_site
搜索站点，支持多条件过滤。

**参数：**
- `site` (str): 站点URL关键词，默认 ""
- `title` (str): 站点标题关键词，默认 ""
- `status` (int): HTTP状态码，默认 0
- `scope_id` (str): 资产范围ID，默认 ""
- `page` (int): 页码，默认 1
- `size` (int): 每页数量，默认 100

**返回：**
- 站点列表及指纹信息（标题、状态码、指纹、IP、favicon）

**使用场景：**
- 按标题搜索站点
- 筛选特定状态码的站点
- 指纹识别

---

## 4. 资产管理 (2个)

### 4.1 list_asset_scopes
列出所有资产范围/分组。

**参数：**
- `page` (int): 页码，默认 1
- `size` (int): 每页数量，默认 100

**返回：**
- 资产范围列表（ID、名称、范围内容、创建时间）

**使用场景：**
- 查看所有资产分组
- 资产组织管理

---

### 4.2 create_asset_scope
创建资产范围/分组。

**参数：**
- `name` (str): 范围名称
- `scope` (str): 范围内容（域名、IP或IP段，多个用换行符分隔）

**返回：**
- 创建结果

**使用场景：**
- 创建新的资产分组
- 组织管理资产

---

## 5. 安全扫描 (2个)

### 5.1 search_nuclei_result
搜索 Nuclei 漏洞扫描结果。

**参数：**
- `url` (str): URL关键词，默认 ""
- `page` (int): 页码，默认 1
- `size` (int): 每页数量，默认 100

**返回：**
- 漏洞列表（URL、模板ID、模板名称、严重程度、匹配内容）

**使用场景：**
- 漏洞扫描结果查询
- 安全风险评估
- 漏洞报告生成

---

### 5.2 list_policies
列出所有扫描策略。

**参数：**
- `page` (int): 页码，默认 1
- `size` (int): 每页数量，默认 100

**返回：**
- 策略列表（ID、名称、策略配置）

**使用场景：**
- 查看可用的扫描策略
- 策略管理

---

## 工具统计

- **总计：25 个工具**
- 辅助工具：3 个
- 任务管理：7 个
- 资产查询：7 个
- 资产管理：2 个
- 安全扫描：2 个
- 数据导出：4 个（包含在任务管理和资产查询中）

## API 覆盖率

当前 MCP 服务器覆盖了 ARL 113 个 API 端点中的约 25 个最常用的端点，覆盖率约 22%。

主要覆盖的功能模块：
- ✅ 任务管理（完整）
- ✅ 资产查询（核心功能）
- ✅ 资产管理（基础功能）
- ✅ 安全扫描（Nuclei 结果）
- ⚠️ 监控任务（未覆盖）
- ⚠️ GitHub 监控（未覆盖）
- ⚠️ FOFA 集成（未覆盖）
- ⚠️ 证书查询（未覆盖）

## 未来扩展

可以考虑添加的功能：
1. 监控任务管理（scheduler）
2. GitHub 监控功能
3. FOFA 任务集成
4. 证书查询功能
5. 批量导出功能
6. 指纹管理
7. POC 管理
8. 用户管理
